## 基于OAuth2.0的第三方认证登录

第三方登录是指用户在第三方平台上已有的账号和密码来快速完成己方应用的登录或者注册的功能。而这里的第三方平台，一般是已经拥有大量用户的平台，比如国内的微博、微信、QQ等，国外的Facebook，Twitter等。简单来说就是用户通过微信，微博等账号授权登录我们自己的应用，而不再用输入账号和密码。

* google开发文档地址： https://developers.google.com/identity/protocols/oauth2?hl=zh-cn
* facebook开发文档地址：https://developers.facebook.com/docs/facebook-login/guides/advanced/manual-flow

### 为什么要有第三方登录功能

* 简化登录注册过程，降低用户的登录流失率
  简化登录过程，降低注册门槛，更能获取海量用户，有效降低了用户的流失，在争抢用户，提高用户转化率注册量是不可缺少的重要因素。本地注册的稳定+第三方登录的便捷才是最合适的登录方案。

* 方便应用获取用户信息，减少产品设计成本
  第三方登录接入后，应用可直接获取用户昵称、头像、用户ID等信息，方便产品获取用户的基本资料。

* 减少短信验证码发送次数，降低产品登录成本
  目前市面上的短信验证码的价钱约在0.05元左右，当用户选择使用第三方登录时，可有效减少产品的登录成本

### 什么是OAuth2.0

OAuth 2.0 授权框架使第三方应用程序能够获得对 HTTP 服务的有限访问，无论是代表通过协调资源所有者和 HTTP 服务之间的批准交互，或者允许第三方应用程序代表其自己获取访问权限，可以向资源所有者授予权限；

<b>参考链接</b>：（EN）https://datatracker.ietf.org/doc/html/rfc6749  （CN）https://github.com/jeansfish/RFC6749.zh-cn

### 基于授权码模式的认证流程

![](https://github.com/TT-thzy/notes-tt/blob/company/picture%20service/thirdOAuthFlow.png)

1. 客户端对资源所有者发起获取第三方应用访问的权限的请求;
2. 资源所有者输入认证信息后，即同意授权给客户端访问受限资源的访问，客户端发送获取第三方应用访问令牌的请求;
3. 服务端获取请求后，校验用户输入的认证信息是否合法，如何合法，服务端(这里的服务端包括后面的服务端其实都是第三方服务的授权服务应用在进行交互)返回一个授权码给客户端;
4. 客户端获取到授权码后，发送通过授权码换取访问令牌证的请求;
5. 服务端获取到授权码后，校验授权码的合法性后，发放相应权限的访问令牌;
6. 客户端收到访问令牌后，就可通过该凭证访问服务端受保护的资源;

<b>详细流程图</b>:

![](https://github.com/TT-thzy/notes-tt/blob/company/picture%20service/thidOAuthProcess.png)

### 类图设计

![](https://github.com/TT-thzy/notes-tt/blob/company/picture%20service/thirdAuth.png)
